# Clash_Rule_FISH

- è¿™æ˜¯ä¸€ä¸ª**mihomo**çš„ **`é…ç½®æ–‡ä»¶`** + **`Rulesetè§„åˆ™é›†åˆ`** ä»“åº“ï¼Œä½†**ä¸ªäººè‰²å½©**æ¯”è¾ƒé‡ï¼Œæ›´æ¨èä½œä¸ºå‚è€ƒè€Œä¸æ˜¯ç›´æ¥å¼•ç”¨ã€‚

  > å½“ç„¶ç›´æ¥å¼•ç”¨ä¹Ÿå¯ä»¥ğŸ˜‚

- ä»“åº“æä¾›çš„[mihomoé…ç½®æ–‡ä»¶æ¨¡æ¿](https://raw.githubusercontent.com/refined-fish/clash_rule_fish/refs/heads/main/FISH-Template.yaml)æ— æ³•ç›´æ¥å¯¼å…¥è½¯ä»¶è¿è¡Œï¼Œç¼ºå°‘å¿…è¦çš„æœºåœºè®¢é˜…ï¼Œè¯·è‡ªè¡Œä¿®æ”¹åä½¿ç”¨ã€‚ï¼ˆ[ä¿®æ”¹æ•™ç¨‹](https://github.com/refined-fish/clash_rule_fish#mihomo-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B)ï¼‰

- ç”±äºæœ€å¸¸ç”¨çš„è®¢é˜…è½¬æ¢å·¥å…· [`subconverter`](https://github.com/tindy2013/subconverter) ä¸æ”¯æŒmihomoçš„é«˜çº§åŠŸèƒ½ï¼Œæ— æ³•å°†æœ¬ä»“åº“ç›´æ¥å˜æˆ `subconverter` çš„è¿œç¨‹é…ç½®ä½¿ç”¨ã€‚å¦‚æœä½ æƒ³ç”¨æœ¬ä»“åº“çš„æ¨¡æ¿å®ç°è¿œç¨‹è®¢é˜…ï¼Œè‡ªåŠ¨åŒæ­¥ä»“åº“æ›´æ–°ï¼Œæ­¤å¤„æä¾›ä¸€ç§è¾ƒä¸º[å¤æ‚çš„æ–¹æ¡ˆ](https://github.com/refined-fish/clash_rule_fish#%E5%B0%86%E6%9C%AC%E4%BB%93%E5%BA%93%E4%BD%9C%E4%B8%BA%E8%BF%9C%E7%A8%8B%E8%AE%A2%E9%98%85%E4%BD%BF%E7%94%A8)ã€‚

- å…³äº `è·¯ç”±è§„åˆ™Rule` éƒ¨åˆ†ï¼Œåœ¨éå¿…è¦æ—¶ï¼Œæ›´æ¨èå„ä½æœ‹å‹ç›´æ¥ä½¿ç”¨ **`geoæ•°æ®åº“`** ï¼Œå‡å°‘å¤–éƒ¨ä¾èµ–ï¼Œç®€åŒ–é…ç½®æ–‡ä»¶ï¼Œæå‡ä½¿ç”¨ä½“éªŒâ¤ï¸

- **å€¼å¾—æ³¨æ„çš„æ˜¯**ï¼Œæ— è®ºä½ æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘éƒ½å»ºè®®ä½ å…ˆæŸ¥çœ‹ **mihomo [å®˜æ–¹æ–‡æ¡£](https://wiki.metacubex.one/config/general/)**ï¼Œä»¥åŠå­¦ä¼š **`yaml`** çš„ä¸€èˆ¬è¯­æ³•ï¼Œå¦åˆ™ä½ æ—¢ä¸èƒ½å­¦ä¼š mihomo çš„ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½æµªè´¹è‡ªå·±å’Œå¤§å®¶çš„æ—¶é—´ğŸ¥²

- æ¬¢è¿å„ä½åœ¨ `issue` å‹å–„ğŸ™Œè®¨è®ºï¼Œæˆ‘çœ‹åˆ°äº†éƒ½ä¼šæŠ½æ—¶é—´å›å¤ã€‚

## æ›´æ–°æ—¥å¿—

å‚è§[ChangeLog.log](https://raw.githubusercontent.com/refined-fish/clash_rule_fish/refs/heads/main/ChangeLog.log)æ–‡ä»¶ã€‚

## Ruleset è¯´æ˜

**`â™»ï¸è‡ªåŠ¨é€‰æ‹©-FISH`** ï¼šæ­¤è§„åˆ™æ”¶å½•çš„ä¸»è¦æ˜¯ `geosite:gfw` ä»¥å¤–ï¼Œå¿…é¡»ä»£ç†å’Œä»£ç†åä½“éªŒæ›´å¥½çš„åŸŸåã€‚

**`ğŸŒDirect-FISH`** ï¼šæ­¤è§„åˆ™æ”¶å½•çš„æ˜¯è¢«åŒ…æ‹¬åœ¨ `ä¸€èˆ¬ä»£ç†è§„åˆ™é›†` å†…ï¼Œä½†æ˜¯å®é™…å¯ä»¥ç›´è¿çš„åŸŸåã€‚

## Icon è¯´æ˜

mihomo æ”¯æŒä¸ºä»£ç†ç»„è®¾ç½®iconå­—æ®µæ¥è®©æ˜¾ç¤ºæ›´æ¼‚äº®ç›´è§‚ï¼Œæ­¤å¤„æ”¶é›†äº†éƒ¨åˆ† `åˆ†è¾¨ç‡ä¸ºpx48` çš„iconå›¾æ ‡ä»¥ä¾›å¼•ç”¨ï¼Œæ•ˆæœå¦‚ä¸‹
  
  ![image](https://github.com/user-attachments/assets/9fbfd5f6-fe80-4745-8ba0-e1716ccce26f)

## iKuai-Rule è¯´æ˜

æ­¤æ–‡ä»¶å¤¹å†…å®¹ä¸º `çˆ±å¿«+openWRTåŒwanåŒè·¯ç”±` æ¶æ„ä¸‹ï¼Œæ­é… [ikuai-bypassé¡¹ç›®](https://github.com/joyanhui/ikuai-bypass) ä½¿ç”¨çš„

- åŸŸåç›´è¿åˆ†æµè§„åˆ™
- IPç›´è¿åˆ†æµè§„åˆ™

## å¦‚ä½•ä¿®æ”¹ mihomo é…ç½®æ–‡ä»¶æ¨¡æ¿

1. æ‰¾åˆ°æ¨¡æ¿ä¸­ `ä»£ç†åˆé›†` éƒ¨åˆ†

    ```yaml
    proxy-providers-general: &proxy-providers-general
      type: http      # ç±»å‹ï¼Œå¯é€‰http/file
      interval: 86400
      proxy: DIRECT
      size-limit: 0
      override:
        tfo: false  # å¯ç”¨TCP Fast Openï¼Œä¸€èˆ¬éƒ½ä¸æ”¯æŒ
        mptcp: false  # å¯ç”¨TCP Multi Pathï¼Œä¸€èˆ¬éƒ½ä¸æ”¯æŒ
        udp: true
        udp-over-tcp: false  # å¯ç”¨ UDP over TCP
        skip-cert-verify: false  # è·³è¿‡è¯ä¹¦éªŒè¯

    proxy-providers:
      #â—providerå ä½1
      #â—providerå ä½2
      #â—providerå ä½3
      #â—providerå ä½4
    ```

2. å°† `#â—providerå ä½` ä¿®æ”¹ä¸ºåŒ…å«è‡ªå·±æœºåœºè®¢é˜…åœ°å€çš„å†…å®¹ï¼Œæœ‰å‡ ä¸ªæœºåœºè®¢é˜…ä¿®æ”¹å‡ ä¸ªå ä½ç¬¦

    ```yaml
    proxy-providers-general: &proxy-providers-general
      type: http      # ç±»å‹ï¼Œå¯é€‰http/file
      interval: 86400
      proxy: DIRECT
      size-limit: 0
      override:
        tfo: false  # å¯ç”¨TCP Fast Openï¼Œä¸€èˆ¬éƒ½ä¸æ”¯æŒ
        mptcp: false  # å¯ç”¨TCP Multi Pathï¼Œä¸€èˆ¬éƒ½ä¸æ”¯æŒ
        udp: true
        udp-over-tcp: false  # å¯ç”¨ UDP over TCP
        skip-cert-verify: false  # è·³è¿‡è¯ä¹¦éªŒè¯

    proxy-providers:
      provider1:
        <<: *proxy-providers-general  # å¼•ç”¨ä¸Šæ–¹yamlé”šç‚¹
        url: "ä½ çš„æœºåœºè®¢é˜…åœ°å€"
        override:  #å¯é€‰ï¼Œè¦†å†™è®¾ç½®ï¼Œä¸éœ€è¦å¯ä»¥åˆ é™¤
          additional-prefix: "provider1|"  # å¯é€‰ï¼Œç»™è®¢é˜…æ·»åŠ å‰ç¼€ï¼Œä¸éœ€è¦å¯ä»¥åˆ é™¤
        path: ./providers/proxy-provider1.yaml  # å¯é€‰ï¼ŒæŒ‡å®šä¸‹è½½è·¯å¾„ï¼Œä¸éœ€è¦å¯ä»¥åˆ é™¤
      #â—providerå ä½2
      #â—providerå ä½3
      #â—providerå ä½4
    ```

3. æ‰¾åˆ°ç­–ç•¥ç»„éƒ¨åˆ†

    ```yaml
    use-all-proxy-providers: &use-all-proxy-providers
      use:
        #â—use-providerå ä½1
        #â—use-providerå ä½2
        #â—use-providerå ä½3
        #â—use-providerå ä½4
    ```

4. å°†ç¬¬2.æ­¥ä¿®æ”¹è¿‡çš„ `#â—providerå ä½` å¼•ç”¨è¿›å»ï¼ŒåŒä¸Šï¼Œä½ å†™äº†å‡ ä¸ªè®¢é˜…å°±æ”¹å‡ ä¸ªå¼•ç”¨

    ```yaml
    use-all-proxy-providers: &use-all-proxy-providers
      use:
        - provider1
        #â—use-providerå ä½2
        #â—use-providerå ä½3
        #â—use-providerå ä½4
    ```

5. ç„¶åå°±å¯ä»¥å¯¼å…¥é…ç½®æ–‡ä»¶ä½¿ç”¨äº†ã€‚

## å¦‚ä½•å°†æœ¬ä»“åº“ä½œä¸ºè¿œç¨‹è®¢é˜…ä½¿ç”¨

  è‹¥æƒ³å°†æœ¬ä»“åº“æ¨¡æ¿å˜æˆè¿œç¨‹è®¢é˜…ï¼Œéœ€è¦ï¼š

  1. æœ‰è‡ªå·±çš„ `nginxåå‘ä»£ç†` æœåŠ¡å™¨
  2. æŒæ¡ `nginxåå‘ä»£ç†` ä¸€èˆ¬ç”¨æ³•:

  æ­£å¼å¼€å§‹ï¼š

  1. ç”¨è‡ªå·±çš„ `NGINXåå‘ä»£ç†æœåŠ¡å™¨` åå‘ä»£ç†æœ¬ä»“åº“çš„æ¨¡æ¿æ–‡ä»¶ã€‚
  2. åœ¨åå‘ä»£ç†ä¸­ä½¿ç”¨ `nginx_http_sub` å­æ¨¡å—çš„ `sub_filter` åŠŸèƒ½ï¼Œè‡ªåŠ¨æ›¿æ¢æ¨¡æ¿ä¸­çš„ `â—å ä½ç¬¦` å­—æ®µä¸ºè‡ªå·±çš„ `æœºåœºè®¢é˜…` å­—æ®µã€‚

      ```yaml
      sub_filter '#â—providerå ä½1' 'provider1:\n    <<: *proxy-providers-general\n    override:\n      additional-prefix: "ä¸€å…ƒ|"\n    url: "ä½ çš„æœºåœºè®¢é˜…"\n    path: ./providers/proxy-provider1.yaml';
      sub_filter '#â—use-providerå ä½1' '- provider1';
      ```

  3. ç„¶åå°±å¯ä»¥å°†è‡ªå·±çš„åå‘ä»£ç†åœ°å€å¯¼å…¥mihomoè½¯ä»¶ä¸­å¿«ä¹ä½¿ç”¨ï¼Œå¯ä»¥å®æ—¶åŒæ­¥æˆ‘çš„æ›´æ–°ï¼ˆä½†ä½ éœ€è¦æ‹…å¿ƒæˆ‘çš„ä¸æ­£ç¡®æ›´æ–°å¾€é…ç½®æ–‡ä»¶é‡ŒæºğŸ’©ï¼‰ã€‚

## è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹äººå‘˜çš„å¸®åŠ©
> [@morytyann](https://github.com/morytyann)
